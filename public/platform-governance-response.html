<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Platform Governance Response — EthicsLens Pro</title>
<style>
  :root { --navy: #1a2332; --blue: #2563eb; --green: #16a34a; --amber: #d97706; --gray: #64748b; --light: #f8fafc; --border: #e2e8f0; }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Georgia', serif; color: var(--navy); background: var(--light); line-height: 1.7; }
  .container { max-width: 800px; margin: 0 auto; padding: 40px 24px; }
  header { border-bottom: 3px solid var(--navy); padding-bottom: 24px; margin-bottom: 32px; }
  header h1 { font-size: 1.6rem; color: var(--navy); margin-bottom: 4px; }
  header p { font-size: 0.9rem; color: var(--gray); }
  .date { font-size: 0.85rem; color: var(--gray); margin-bottom: 24px; }
  h2 { font-size: 1.15rem; color: var(--navy); margin: 32px 0 12px; border-left: 4px solid var(--blue); padding-left: 12px; }
  p, li { font-size: 0.95rem; margin-bottom: 10px; }
  ul { padding-left: 20px; }
  .status-badge { display: inline-block; padding: 3px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; font-family: sans-serif; }
  .done { background: #dcfce7; color: var(--green); }
  .pending { background: #fef3c7; color: var(--amber); }
  .formula-box { background: #f1f5f9; border: 1px solid var(--border); border-radius: 6px; padding: 16px 20px; margin: 16px 0; font-family: 'Courier New', monospace; font-size: 0.9rem; }
  .section { margin-bottom: 28px; }
  .answer { background: white; border: 1px solid var(--border); border-radius: 6px; padding: 16px 20px; margin: 8px 0; }
  footer { border-top: 2px solid var(--border); margin-top: 40px; padding-top: 20px; font-size: 0.8rem; color: var(--gray); }
  @media print { body { background: white; } .container { padding: 20px; } }
</style>
</head>
<body>
<div class="container">

<header>
  <h1>Platform Governance Response</h1>
  <p>EthicsLens Pro — Architectural Verification &amp; 70/30 Weighting Confirmation</p>
</header>

<p class="date">Prepared: February 18, 2026 &nbsp;|&nbsp; For: Mark Katchen, CIH, FAIHA</p>

<div class="section">
  <p>Mark,</p>
  <p>Thank you for the thorough governance review. Below is a point-by-point confirmation of all items you raised, including the now-implemented 70/30 weighting structure.</p>
</div>

<h2>1. 70/30 Weighting — Implemented <span class="status-badge done">✓ COMPLETE</span></h2>

<div class="answer">
  <p>The composite score now reflects the book's framework, giving professional codes primacy over ethical lenses:</p>

  <div class="formula-box">
    compositeScore = (0.70 × codeComplianceScore) + (0.30 × lensAverage)
  </div>

  <p><strong>How it works:</strong></p>
  <ul>
    <li>Each selected professional code (BCSP/ASSP, AIHA/ABIH, AAOHN, ACOEM) receives a compliance score (1–10) generated by AI analysis</li>
    <li>These are averaged into a single <strong>codeComplianceScore</strong></li>
    <li>The six ethical lens scores are averaged into a <strong>lensAverage</strong></li>
    <li>The composite is calculated deterministically in TypeScript — AI output cannot override it</li>
  </ul>

  <p><strong>Your three questions answered:</strong></p>

  <p><em>Q1: Exact formula?</em><br>
  <code>compositeScore = 0.70 × codeComplianceAvg + 0.30 × lensAverage</code>, rounded to 1 decimal place. Both components are clamped to 1–10 integers before weighting.</p>

  <p><em>Q2: Do code violations affect composite scoring?</em><br>
  <strong>Yes, both.</strong> Code violations cap Duty and Rights lens scores at 4/10 (affecting the 30% component), AND cap all code compliance scores at 4/10 (heavily impacting the 70% component). The case is also classified as "ethically unstable."</p>

  <p><em>Q3: Is weighting visible to users?</em><br>
  <strong>Yes.</strong> The results page now transparently displays:<br>
  &bull; Code Compliance: X/10 (70%)<br>
  &bull; Lens Average: Y/10 (30%)<br>
  directly beneath the composite score circle.</p>
</div>

<h2>2. Algorithm Verification <span class="status-badge done">✓ CONFIRMED</span></h2>

<div class="answer">
  <p>The deterministic scoring logic resides in <code>supabase/functions/analyze-case/index.ts</code>, specifically in the <code>applyGuardrails()</code> function. This function:</p>
  <ul>
    <li>Clamps all scores to 1–10 integers</li>
    <li>Enforces code violation caps (Duty/Rights ≤ 4 when violated)</li>
    <li>Calculates composite using the 70/30 formula deterministically</li>
    <li>Determines conflict level from score divergence</li>
    <li>Sets ethical stability classification</li>
    <li>Flags all enforced results with <code>_guardrailsApplied: true</code></li>
  </ul>
  <p><strong>AI output cannot override any of these calculations.</strong> The AI provides narrative reasoning; the code enforces all numeric constraints.</p>
</div>

<h2>3. Secrets &amp; Keys <span class="status-badge done">✓ CONFIRMED</span></h2>

<div class="answer">
  <ul>
    <li>The Gemini API key is stored as a server-side secret — never exposed to the browser</li>
    <li>No private keys appear in client-side code</li>
    <li>The only client-side key is the publishable anon key, which is safe by design and governed by Row-Level Security policies</li>
  </ul>
</div>

<h2>4. GitHub Transfer &amp; Ownership <span class="status-badge pending">PENDING — FINAL PHASE</span></h2>

<div class="answer">
  <p>The project supports bidirectional GitHub sync. The full codebase — frontend (React/TypeScript), backend functions (Deno/TypeScript), and database schema/migrations — is contained in the repository.</p>
  <p><strong>Plan:</strong> GitHub repository creation and owner transfer to your account will be completed as a final deliverable step, once all functional milestones are approved. This ensures you receive the clean, final version of the codebase.</p>
</div>

<h2>5. Database Ownership &amp; Portability <span class="status-badge pending">PENDING — FINAL PHASE</span></h2>

<div class="answer">
  <p>The database (Postgres) supports full SQL dump and migration export. Admin access credentials and ownership transfer will be arranged in the final delivery phase alongside the GitHub transfer.</p>
</div>

<h2>6. Runtime Independence <span class="status-badge done">✓ CONFIRMED</span></h2>

<div class="answer">
  <p>The application can be built and deployed independently using only the exported repository. The stack (Vite/React frontend, Deno edge functions, Postgres database) has no proprietary runtime dependencies. It can be hosted on Vercel, Netlify, AWS, or any standard environment.</p>
</div>

<footer>
  <p>EthicsLens Pro — Confidential Project Documentation</p>
  <p>Prepared by the development team for stakeholder review.</p>
</footer>

</div>
</body>
</html>